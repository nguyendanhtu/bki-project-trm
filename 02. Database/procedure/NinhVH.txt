--2012/06/25

GO
CREATE PROC [dbo].[pr_V_DM_DOT_THANH_TOAN_LoadTheoThoiGian_va_giangvien]
@GIANG_VIEN DECIMAL,
@THANG_TT DECIMAL,
@NAM_TT DECIMAL,
@ID_DON_VI_TT DECIMAL
as
SELECT * FROM V_DM_DOT_THANH_TOAN vddtt
WHERE (MONTH(vddtt.NGAY_TT_DU_KIEN) = @THANG_TT OR @THANG_TT =0)
AND (YEAR(vddtt.NGAY_TT_DU_KIEN)=@NAM_TT OR @NAM_TT=0)
AND (vddtt.ID_DON_VI_THANH_TOAN = @ID_DON_VI_TT OR @ID_DON_VI_TT =0)
AND vddtt.MA_DOT_TT IN (SELECT gtt.SO_PHIEU_THANH_TOAN FROM V_GD_THANH_TOAN gtt WHERE gtt.ID_GIANG_VIEN = @GIANG_VIEN)
ORDER BY vddtt.ID desc

--2012/06/26
ALTER PROCEDURE [dbo].[pr_V_GD_THANH_TOAN_GetTongHopThanhToanByGiangVienvaDVThanhToan]
@ID_GIANG_VIEN DECIMAL
,@ID_DON_VI_TT DECIMAL
,@THANG_TT DECIMAL
,@NAM_TT DECIMAL
as
SELECT 
 vgtt.SO_PHIEU_THANH_TOAN
, vgtt.ID_GIANG_VIEN
, SUM(vgtt.TONG_TIEN_THANH_TOAN) AS [TONG_TIEN_THANH_TOAN]
FROM V_GD_THANH_TOAN vgtt
WHERE (vgtt.ID_GIANG_VIEN = @ID_GIANG_VIEN OR @ID_GIANG_VIEN=0)
AND vgtt.SO_PHIEU_THANH_TOAN IN (
	SELECT ddtt.MA_DOT_TT FROM DM_DOT_THANH_TOAN ddtt
	WHERE ddtt.ID_DON_VI_THANH_TOAN = @ID_DON_VI_TT OR @ID_DON_VI_TT =0)
AND (MONTH(vgtt.NGAY_THANH_TOAN) = @THANG_TT OR @THANG_TT =0)
AND (YEAR(vgtt.NGAY_THANH_TOAN) = @NAM_TT OR @NAM_TT =0)
GROUP BY vgtt.SO_PHIEU_THANH_TOAN, vgtt.ID_GIANG_VIEN
--2012/06/28
GO
ALTER PROCEDURE [dbo].[pr_V_DM_DOT_THANH_TOAN_Search]
 @MA_DOT_TT NVARCHAR(50)
AS 
SELECT * FROM V_DM_DOT_THANH_TOAN vddtt
WHERE vddtt.MA_DOT_TT = @MA_DOT_TT
ORDER BY vddtt.ID DESC