CREATE PROCEDURE [dbo].[pr_V_GD_THANH_TOAN_GetThanhToanByGiangVien_thang_nam_dot_va_DVThanhToan]
@ID_GIANG_VIEN DECIMAL
,@ID_DON_VI_TT DECIMAL
,@ID_TRANG_THAI_TT DECIMAL
,@LOAI_HOP_DONG NVARCHAR(5)
,@REFERENCE_CODE NVARCHAR(50)
,@THANG_TT DECIMAL
,@NAM_TT DECIMAL
,@MA_DOT_THANH_TOAN NVARCHAR(250)
as
SELECT * FROM V_GD_THANH_TOAN vgtt
WHERE (vgtt.ID_GIANG_VIEN =@ID_GIANG_VIEN OR @ID_GIANG_VIEN=0)
AND (vgtt.LOAI_HOP_DONG = @LOAI_HOP_DONG OR @LOAI_HOP_DONG ='All')
AND vgtt.SO_PHIEU_THANH_TOAN IN (
	SELECT ddtt.MA_DOT_TT FROM DM_DOT_THANH_TOAN ddtt
	WHERE ddtt.ID_DON_VI_THANH_TOAN = @ID_DON_VI_TT OR @ID_DON_VI_TT =0)
AND (MONTH(vgtt.NGAY_THANH_TOAN) = @THANG_TT OR @THANG_TT =0)
AND (YEAR(vgtt.NGAY_THANH_TOAN) = @NAM_TT OR @NAM_TT =0)
AND  (vgtt.ID_TRANG_THAI_THANH_TOAN =@ID_TRANG_THAI_TT OR @ID_TRANG_THAI_TT = 0)
AND (vgtt.REFERENCE_CODE LIKE N'%'+@REFERENCE_CODE+'%' OR @REFERENCE_CODE ='')
AND (vgtt.SO_PHIEU_THANH_TOAN = @MA_DOT_THANH_TOAN OR @MA_DOT_THANH_TOAN = 'All')
ORDER BY vgtt.ID 

Go
-- 18/06/2012---
-- Alter view lập công việc cho GVCM
ALTER VIEW [dbo].[V_GD_GV_CONG_VIEC_MOI]
AS
SELECT
cvm.ID,
cvm.ID_HOP_DONG_KHUNG,
hdk.SO_HOP_DONG,
RTRIM(LTRIM(gv.HO_VA_TEN_DEM)) + ' ' + RTRIM(LTRIM(gv.TEN_GIANG_VIEN)) AS HO_VA_TEN_GIANG_VIEN,
cvm.ID_NOI_DUNG_TT,
ndtt.TEN_NOI_DUNG,
cvm.SO_LUONG_HE_SO,
cvm.SO_LUONG_NGHIEM_THU,
cvm.DON_GIA,
cvm.NGAY_DAT_HANG,
cvm.NGAY_NGHIEM_THU,
cvm.ID_TRANG_THAI,
cdtd.TEN AS TEN_TRANG_THAI,
cvm.ID_USER_NHAP,
nsd.TEN_TRUY_CAP,
cvm.GHI_CHU
FROM GD_GV_CONG_VIEC_MOI cvm, DM_HOP_DONG_KHUNG hdk, DM_NOI_DUNG_THANH_TOAN ndtt,
	DM_GIANG_VIEN gv, HT_NGUOI_SU_DUNG nsd, CM_DM_TU_DIEN cdtd
where cvm.ID_HOP_DONG_KHUNG = hdk.ID
AND cvm.ID_NOI_DUNG_TT = ndtt.ID
AND gv.ID = hdk.ID_GIANG_VIEN
AND nsd.ID = cvm.ID_USER_NHAP
AND cvm.ID_TRANG_THAI = cdtd.ID


GO
CREATE PROCEDURE pr_V_DM_GIANG_VIEN_Load_data_2_cbo
AS
SELECT * FROM DM_GIANG_VIEN dgv
WHERE dgv.ID IN
(SELECT DISTINCT dhdk.ID_GIANG_VIEN
   FROM GD_GV_CONG_VIEC_MOI ggcvm,DM_HOP_DONG_KHUNG dhdk
 WHERE ggcvm.ID_HOP_DONG_KHUNG = dhdk.ID)

Go

CREATE PROCEDURE pr_V_GD_GV_CONG_VIEC_MOI_Loc_Duyet_Ke_Hoach
	@ID_HOP_DONG_KHUNG DECIMAL,
	@ID_TRANG_THAI DECIMAL
AS
	SELECT * FROM V_GD_GV_CONG_VIEC_MOI cvm
	WHERE (cvm.ID_HOP_DONG_KHUNG = @ID_HOP_DONG_KHUNG OR @ID_HOP_DONG_KHUNG = 0)
	AND (@ID_TRANG_THAI = 0 OR cvm.ID_TRANG_THAI = @ID_TRANG_THAI)