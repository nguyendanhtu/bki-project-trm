CREATE PROCEDURE [dbo].[pr_V_GD_THANH_TOAN_GetThanhToanByGiangVien_thang_nam_dot_va_DVThanhToan]
@ID_GIANG_VIEN DECIMAL
,@ID_DON_VI_TT DECIMAL
,@ID_TRANG_THAI_TT DECIMAL
,@LOAI_HOP_DONG NVARCHAR(5)
,@REFERENCE_CODE NVARCHAR(50)
,@THANG_TT DECIMAL
,@NAM_TT DECIMAL
,@MA_DOT_THANH_TOAN NVARCHAR(250)
as
SELECT * FROM V_GD_THANH_TOAN vgtt
WHERE (vgtt.ID_GIANG_VIEN =@ID_GIANG_VIEN OR @ID_GIANG_VIEN=0)
AND (vgtt.LOAI_HOP_DONG = @LOAI_HOP_DONG OR @LOAI_HOP_DONG ='All')
AND vgtt.SO_PHIEU_THANH_TOAN IN (
	SELECT ddtt.MA_DOT_TT FROM DM_DOT_THANH_TOAN ddtt
	WHERE ddtt.ID_DON_VI_THANH_TOAN = @ID_DON_VI_TT OR @ID_DON_VI_TT =0)
AND (MONTH(vgtt.NGAY_THANH_TOAN) = @THANG_TT OR @THANG_TT =0)
AND (YEAR(vgtt.NGAY_THANH_TOAN) = @NAM_TT OR @NAM_TT =0)
AND  (vgtt.ID_TRANG_THAI_THANH_TOAN =@ID_TRANG_THAI_TT OR @ID_TRANG_THAI_TT = 0)
AND (vgtt.REFERENCE_CODE LIKE N'%'+@REFERENCE_CODE+'%' OR @REFERENCE_CODE ='')
AND (vgtt.SO_PHIEU_THANH_TOAN = @MA_DOT_THANH_TOAN OR @MA_DOT_THANH_TOAN = 'All')
ORDER BY vgtt.ID 

